<!DOCTYPE html>
<html lang="en" x-data="moodAnalytics()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Analytics - Sahara AI</title>
    
    <!-- Modern UI Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Icons & Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 25%, #1e40af 50%, #1d4ed8 75%, #2563eb 100%);
            min-height: 100vh;
        }
        
        /* Glass morphism effects */
        .glass-card {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        /* Therapeutic color scheme */
        :root {
            --therapeutic-primary: #7C9885;
            --therapeutic-secondary: #6B9BD1;
            --therapeutic-accent: #A8C69F;
            --therapeutic-dark: #5A7C65;
        }
        
        .btn-therapeutic {
            background: linear-gradient(135deg, var(--therapeutic-primary), var(--therapeutic-secondary));
            transition: all 0.3s ease;
        }
        
        .btn-therapeutic:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 152, 133, 0.3);
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Rating buttons */
        .rating-btn {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .rating-btn:hover {
            transform: scale(1.1);
        }
        
        .rating-btn.selected {
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
        }
    </style>
</head>

<body class="min-h-screen text-white">
    <!-- Navigation Header -->
    <nav class="glass-card border-b border-white/10">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-2xl font-bold text-white hover:text-blue-200 transition-colors">
                        🌸 Sahara AI
                    </a>
                    <span class="text-white/60">|</span>
                    <h1 class="text-xl font-semibold text-white/90">Mood Analytics Dashboard</h1>
                </div>
                
                <div class="flex items-center space-x-3">
                    <div class="text-sm text-white/70" x-text="currentTime"></div>
                    <a href="/chat" class="btn-therapeutic px-4 py-2 rounded-lg text-white text-sm font-medium">
                        <i class="fas fa-comments mr-2"></i>Chat
                    </a>
                    <a href="/mood-checkin" class="btn-therapeutic px-4 py-2 rounded-lg text-white text-sm font-medium">
                        <i class="fas fa-plus mr-2"></i>Add Entry
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Mood Check-in Section -->
        <div x-show="!selectedMood" class="glass-card rounded-xl p-8 mb-8">
            <div class="text-center mb-8">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-heart text-2xl text-white"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">How are you feeling today?</h2>
                <p class="text-white/70">Select your current mood to track your emotional journey</p>
            </div>
            
            <!-- Mood Selection Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
                <template x-for="mood in moods" :key="mood.label">
                    <button @click="selectMood(mood)" 
                            class="glass-card p-6 rounded-xl hover:bg-white/10 transition-all duration-200 transform hover:scale-105 group">
                        <div class="text-center">
                            <div class="text-4xl mb-3" x-text="mood.emoji"></div>
                            <div class="text-white font-medium capitalize" x-text="mood.label"></div>
                            <div class="text-white/50 text-sm mt-1" x-text="mood.description"></div>
                        </div>
                    </button>
                </template>
            </div>
        </div>

        <!-- Intensity Rating -->
        <div x-show="selectedMood && !intensitySelected" class="glass-card rounded-xl p-8 mb-8">
            <div class="text-center mb-8">
                <h3 class="text-2xl font-bold text-white mb-2">Rate Your Intensity</h3>
                <p class="text-white/70">How intense is this feeling? (1 = Low, 10 = High)</p>
            </div>
            
            <!-- Numerical Rating Scale -->
            <div class="flex items-center justify-between text-xs text-white/70 mb-4 max-w-md mx-auto px-2">
                <div class="bg-red-500/10 px-3 py-1 rounded-full border border-red-400/20">
                    <span class="text-red-300 font-medium">Low</span>
                </div>
                <div class="bg-green-500/10 px-3 py-1 rounded-full border border-green-400/20">
                    <span class="text-green-300 font-medium">High</span>
                </div>
            </div>
            
            <div class="flex items-center justify-center space-x-2 max-w-lg mx-auto mb-6">
                <template x-for="rating in [1,2,3,4,5,6,7,8,9,10]" :key="rating">
                    <button @click="setIntensity(rating)" 
                            class="rating-btn w-12 h-12 rounded-full flex items-center justify-center text-white font-bold transition-all duration-200"
                            :class="{
                                'bg-red-400 border-red-500': rating <= 2,
                                'bg-orange-400 border-orange-500': rating >= 3 && rating <= 4,
                                'bg-yellow-400 border-yellow-500': rating >= 5 && rating <= 6,
                                'bg-green-400 border-green-500': rating >= 7 && rating <= 8,
                                'bg-emerald-400 border-emerald-500': rating >= 9,
                                'selected': intensity === rating
                            }"
                            x-text="rating">
                    </button>
                </template>
            </div>
            
            <div x-show="intensity > 0" class="text-center mb-6">
                <div class="inline-flex items-center space-x-2 bg-white/5 rounded-md px-4 py-2">
                    <span class="text-lg font-bold text-white" x-text="intensity"></span>
                    <span class="text-white/80">out of 10</span>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div x-show="intensitySelected && !notesCompleted" class="glass-card rounded-xl p-8 mb-8">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-white mb-2">Add Notes (Optional)</h3>
                <p class="text-white/70">Tell us more about what's affecting your mood today</p>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <textarea x-model="moodNotes" 
                        placeholder="What triggered this mood? Any specific thoughts or events you'd like to track?"
                        class="w-full h-32 bg-white/5 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400/50 resize-none">
                </textarea>
                
                <div class="flex items-center justify-between mt-4">
                    <button @click="skipNotes()" 
                            class="px-6 py-2 text-white/70 hover:text-white transition-colors">
                        Skip Notes
                    </button>
                    <button @click="completeNotes()" 
                            class="btn-therapeutic px-6 py-2 rounded-lg text-white font-medium">
                        Continue
                    </button>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div x-show="notesCompleted" class="glass-card rounded-xl p-8 mb-8">
            <div class="text-center">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-white mb-4">Ready to Submit</h3>
                    <div class="bg-white/5 rounded-xl p-6 max-w-md mx-auto">
                        <div class="flex items-center justify-center space-x-4 mb-4">
                            <div class="text-4xl" x-text="selectedMood?.emoji"></div>
                            <div>
                                <div class="text-xl font-bold text-white capitalize" x-text="selectedMood?.label"></div>
                                <div class="text-white/70" x-text="intensity + '/10 intensity'"></div>
                            </div>
                        </div>
                        <div x-show="moodNotes" class="text-white/60 text-sm italic" x-text="moodNotes.substring(0, 50) + (moodNotes.length > 50 ? '...' : '')"></div>
                    </div>
                </div>
                
                <div class="flex items-center justify-center space-x-4">
                    <button @click="resetForm()" 
                            class="px-6 py-3 border border-white/20 rounded-lg text-white hover:bg-white/5 transition-colors">
                        <i class="fas fa-redo mr-2"></i>Start Over
                    </button>
                    <button @click="submitMood()" 
                            :disabled="submitting"
                            class="btn-therapeutic px-8 py-3 rounded-lg text-white font-bold disabled:opacity-50">
                        <i class="fas fa-check mr-2"></i>
                        <span x-text="submitting ? 'Saving...' : 'Save Entry'"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Analytics Overview -->
        <div x-show="analyticsData" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Wellness Score -->
            <div class="glass-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-heart-pulse text-white text-xl"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-white" x-text="analyticsData?.wellness_score || 0"></div>
                        <div class="text-white/60 text-sm">Wellness Score</div>
                    </div>
                </div>
                <div class="text-white/70 text-sm" x-text="getWellnessMessage(analyticsData?.wellness_score || 0)"></div>
            </div>

            <!-- Current Streak -->
            <div class="glass-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-fire text-white text-xl"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-white" x-text="analyticsData?.current_streak || 0"></div>
                        <div class="text-white/60 text-sm">Day Streak</div>
                    </div>
                </div>
                <div class="text-white/70 text-sm" x-text="getStreakMessage(analyticsData?.current_streak || 0)"></div>
            </div>

            <!-- Total Entries -->
            <div class="glass-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-white" x-text="analyticsData?.total_entries || 0"></div>
                        <div class="text-white/60 text-sm">Total Entries</div>
                    </div>
                </div>
                <div class="text-white/70 text-sm">Keep tracking your mood!</div>
            </div>

            <!-- Mood Trend -->
            <div class="glass-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-trending-up text-white text-xl"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-white" x-text="analyticsData?.mood_trend || 'Building data'"></div>
                        <div class="text-white/60 text-sm">Trend</div>
                    </div>
                </div>
                <div class="text-white/70 text-sm">Your mood pattern</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div x-show="analyticsData && analyticsData.total_entries > 0" class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Mood Trend Chart -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4">
                    <i class="fas fa-chart-line mr-2 text-blue-400"></i>Mood Trend (Last 30 Days)
                </h3>
                <div class="chart-container">
                    <canvas id="moodTrendChart"></canvas>
                </div>
            </div>

            <!-- Mood Distribution -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4">
                    <i class="fas fa-chart-pie mr-2 text-purple-400"></i>Mood Distribution
                </h3>
                <div class="chart-container">
                    <canvas id="moodDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Entries -->
        <div x-show="recentEntries && recentEntries.length > 0" class="glass-card rounded-xl p-6">
            <h3 class="text-xl font-bold text-white mb-6">
                <i class="fas fa-history mr-2 text-green-400"></i>Recent Mood Entries
            </h3>
            
            <div class="space-y-4">
                <template x-for="entry in recentEntries.slice(0, 5)" :key="entry.id">
                    <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="text-2xl" x-text="entry.mood_emoji"></div>
                                <div>
                                    <div class="font-semibold text-white capitalize" x-text="entry.mood_label"></div>
                                    <div class="text-white/60 text-sm" x-text="formatDate(entry.timestamp)"></div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-white" x-text="entry.mood_intensity + '/10'"></div>
                                <div class="text-white/60 text-sm">Intensity</div>
                            </div>
                        </div>
                        <div x-show="entry.notes" class="mt-3 text-white/70 text-sm italic" x-text="entry.notes"></div>
                    </div>
                </template>
            </div>
            
            <div class="text-center mt-6">
                <a href="/mood-history" class="text-blue-300 hover:text-blue-200 underline font-medium">
                    View All Entries
                </a>
            </div>
        </div>

        <!-- Anonymous User Notice -->
        <div x-show="!user.is_authenticated" class="glass-card rounded-xl p-6 border border-amber-400/20 mt-8">
            <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-amber-400 text-lg mt-0.5"></i>
                <div>
                    <h4 class="text-amber-200 font-semibold mb-2">Anonymous Session</h4>
                    <p class="text-amber-100/80 text-sm mb-4">
                        Your mood data is stored locally in your browser only. For persistent tracking across devices, 
                        <a href="/register?next=/mood-analytics" class="text-amber-300 hover:text-amber-200 underline font-medium">create an account</a> 
                        or <a href="/login?next=/mood-analytics" class="text-amber-300 hover:text-amber-200 underline font-medium">sign in</a>.
                    </p>
                    <div class="flex items-center space-x-4 text-xs text-amber-200/70">
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy Protected</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-database"></i>
                            <span>Local Storage Only</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div x-show="showSuccess" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-90"
             x-transition:enter-end="opacity-100 scale-100"
             class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="glass-card rounded-xl p-6 max-w-sm w-full text-center border border-green-400/20">
                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Mood Saved!</h3>
                <p class="text-white/70 mb-4">Your mood entry has been recorded successfully.</p>
                <button @click="showSuccess = false" class="btn-therapeutic px-6 py-2 rounded-lg text-white font-medium">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        function moodAnalytics() {
            return {
                // User data
                user: {{ user|tojson }},
                
                // Time display
                currentTime: '',
                
                // Mood selection
                selectedMood: null,
                intensity: 0,
                intensitySelected: false,
                moodNotes: '',
                notesCompleted: false,
                submitting: false,
                showSuccess: false,
                
                // Analytics data
                analyticsData: null,
                recentEntries: [],
                
                // Available moods
                moods: [
                    { label: 'happy', emoji: '😊', description: 'Feeling great!' },
                    { label: 'excited', emoji: '🤗', description: 'Full of energy' },
                    { label: 'calm', emoji: '😌', description: 'Peaceful and relaxed' },
                    { label: 'content', emoji: '🙂', description: 'Satisfied and at peace' },
                    { label: 'neutral', emoji: '😐', description: 'Neither good nor bad' },
                    { label: 'tired', emoji: '😴', description: 'Feeling worn out' },
                    { label: 'bored', emoji: '😑', description: 'Lacking interest' },
                    { label: 'worried', emoji: '😟', description: 'Feeling anxious' },
                    { label: 'sad', emoji: '😢', description: 'Feeling down' },
                    { label: 'angry', emoji: '😠', description: 'Feeling frustrated' },
                    { label: 'stressed', emoji: '😰', description: 'Under pressure' },
                    { label: 'overwhelmed', emoji: '🤯', description: 'Too much to handle' }
                ],
                
                init() {
                    this.updateTime();
                    setInterval(() => this.updateTime(), 1000);
                    this.loadAnalytics();
                },
                
                updateTime() {
                    this.currentTime = new Date().toLocaleTimeString();
                },
                
                selectMood(mood) {
                    this.selectedMood = mood;
                },
                
                setIntensity(rating) {
                    this.intensity = rating;
                    this.intensitySelected = true;
                },
                
                skipNotes() {
                    this.moodNotes = '';
                    this.notesCompleted = true;
                },
                
                completeNotes() {
                    this.notesCompleted = true;
                },
                
                resetForm() {
                    this.selectedMood = null;
                    this.intensity = 0;
                    this.intensitySelected = false;
                    this.moodNotes = '';
                    this.notesCompleted = false;
                },
                
                async submitMood() {
                    if (!this.selectedMood || !this.intensity) return;
                    
                    this.submitting = true;
                    
                    try {
                        const response = await fetch('/mood', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                mood_emoji: this.selectedMood.emoji,
                                mood_label: this.selectedMood.label,
                                mood_intensity: this.intensity,
                                notes: this.moodNotes,
                                session_id: this.getSessionId()
                            })
                        });
                        
                        if (response.ok) {
                            this.showSuccess = true;
                            this.resetForm();
                            setTimeout(() => {
                                this.showSuccess = false;
                                this.loadAnalytics();
                            }, 2000);
                        }
                    } catch (error) {
                        console.error('Error submitting mood:', error);
                    }
                    
                    this.submitting = false;
                },
                
                async loadAnalytics() {
                    try {
                        const sessionId = this.getSessionId();
                        const response = await fetch(`/mood-history?session_id=${sessionId}`);
                        const data = await response.json();
                        
                        if (data.entries && data.entries.length > 0) {
                            this.recentEntries = data.entries;
                            this.analyticsData = data.analytics || this.generateLocalAnalytics(data.entries);
                            this.createCharts(data.entries);
                        } else if (!this.user.is_authenticated) {
                            // Load from localStorage for anonymous users
                            const localEntries = this.getLocalStorageEntries();
                            if (localEntries.length > 0) {
                                this.recentEntries = localEntries;
                                this.analyticsData = this.generateLocalAnalytics(localEntries);
                                this.createCharts(localEntries);
                            }
                        }
                    } catch (error) {
                        console.error('Error loading analytics:', error);
                        // Fallback to localStorage
                        const localEntries = this.getLocalStorageEntries();
                        if (localEntries.length > 0) {
                            this.recentEntries = localEntries;
                            this.analyticsData = this.generateLocalAnalytics(localEntries);
                            this.createCharts(localEntries);
                        }
                    }
                },
                
                getSessionId() {
                    let sessionId = localStorage.getItem('sahara_session_id');
                    if (!sessionId) {
                        sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('sahara_session_id', sessionId);
                    }
                    return sessionId;
                },
                
                getLocalStorageEntries() {
                    const entries = JSON.parse(localStorage.getItem('sahara_mood_entries') || '[]');
                    return entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                },
                
                generateLocalAnalytics(entries) {
                    if (!entries.length) return null;
                    
                    const totalEntries = entries.length;
                    const recentEntries = entries.slice(0, 7); // Last 7 entries
                    const avgMood = recentEntries.reduce((sum, e) => sum + e.mood_intensity, 0) / recentEntries.length;
                    
                    return {
                        total_entries: totalEntries,
                        wellness_score: Math.round(avgMood * 10) / 10,
                        current_streak: this.calculateLocalStreak(entries),
                        mood_trend: this.getMoodTrend(entries)
                    };
                },
                
                calculateLocalStreak(entries) {
                    if (!entries.length) return 0;
                    
                    let streak = 0;
                    const today = new Date().toDateString();
                    const entryDates = [...new Set(entries.map(e => new Date(e.timestamp).toDateString()))];
                    
                    for (let i = 0; i < entryDates.length; i++) {
                        const checkDate = new Date();
                        checkDate.setDate(checkDate.getDate() - i);
                        const dateStr = checkDate.toDateString();
                        
                        if (entryDates.includes(dateStr)) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                    
                    return streak;
                },
                
                getMoodTrend(entries) {
                    if (entries.length < 3) return 'Building data';
                    
                    const recent = entries.slice(0, 3);
                    const older = entries.slice(3, 6);
                    
                    if (older.length === 0) return 'Building data';
                    
                    const recentAvg = recent.reduce((sum, e) => sum + e.mood_intensity, 0) / recent.length;
                    const olderAvg = older.reduce((sum, e) => sum + e.mood_intensity, 0) / older.length;
                    
                    if (recentAvg > olderAvg + 0.5) return 'Improving';
                    if (recentAvg < olderAvg - 0.5) return 'Declining';
                    return 'Stable';
                },
                
                createCharts(entries) {
                    this.$nextTick(() => {
                        this.createMoodTrendChart(entries);
                        this.createMoodDistributionChart(entries);
                    });
                },
                
                createMoodTrendChart(entries) {
                    const canvas = document.getElementById('moodTrendChart');
                    if (!canvas) return;
                    
                    const ctx = canvas.getContext('2d');
                    
                    // Prepare data for last 30 days
                    const last30Days = [];
                    const moodData = [];
                    
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        const dateStr = date.toDateString();
                        
                        last30Days.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                        
                        const dayEntries = entries.filter(e => new Date(e.timestamp).toDateString() === dateStr);
                        const avgMood = dayEntries.length > 0 
                            ? dayEntries.reduce((sum, e) => sum + e.mood_intensity, 0) / dayEntries.length 
                            : null;
                        
                        moodData.push(avgMood);
                    }
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: last30Days,
                            datasets: [{
                                label: 'Mood Level',
                                data: moodData,
                                borderColor: '#7C9885',
                                backgroundColor: 'rgba(124, 152, 133, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                spanGaps: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: { color: 'white' }
                                }
                            },
                            scales: {
                                x: {
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                y: {
                                    min: 1,
                                    max: 10,
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                }
                            }
                        }
                    });
                },
                
                createMoodDistributionChart(entries) {
                    const canvas = document.getElementById('moodDistributionChart');
                    if (!canvas) return;
                    
                    const ctx = canvas.getContext('2d');
                    
                    // Count mood labels
                    const moodCounts = {};
                    entries.forEach(entry => {
                        moodCounts[entry.mood_label] = (moodCounts[entry.mood_label] || 0) + 1;
                    });
                    
                    const labels = Object.keys(moodCounts);
                    const data = Object.values(moodCounts);
                    const colors = [
                        '#7C9885', '#6B9BD1', '#A8C69F', '#5A7C65',
                        '#8BA690', '#7BA5D6', '#B2D1AA', '#6A8B75'
                    ];
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
                            datasets: [{
                                data: data,
                                backgroundColor: colors.slice(0, labels.length),
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { 
                                        color: 'white',
                                        padding: 20
                                    }
                                }
                            }
                        }
                    });
                },
                
                getWellnessMessage(score) {
                    if (score >= 8) return "Excellent mental wellness!";
                    if (score >= 6.5) return "Good mental health state";
                    if (score >= 5) return "Balanced emotional state";
                    if (score >= 3.5) return "Consider self-care activities";
                    if (score >= 2) return "Focus on mental health support";
                    return "Please consider professional help";
                },
                
                getStreakMessage(streak) {
                    if (streak === 0) return "Start your wellness streak today!";
                    if (streak === 1) return "Great start! Keep it going!";
                    if (streak < 7) return `Amazing! ${streak} days strong!`;
                    if (streak < 30) return `Incredible consistency! ${streak} days!`;
                    return `Wellness champion! ${streak} days!`;
                },
                
                formatDate(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffTime = Math.abs(now - date);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) return 'Today';
                    if (diffDays === 2) return 'Yesterday';
                    if (diffDays <= 7) return `${diffDays - 1} days ago`;
                    
                    return date.toLocaleDateString();
                }
            }
        }
    </script>
</body>
</html>